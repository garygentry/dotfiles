<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 820" width="700" height="820">
  <title>Dependency Resolution - Kahn's Algorithm for Topological Sort</title>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#4A5568"/>
    </marker>
  </defs>
  <style>
    .box { rx: 6; stroke-width: 2; fill: #DBEAFE; stroke: #3B82F6; }
    .box-success { rx: 6; stroke-width: 2; fill: #D1FAE5; stroke: #10B981; }
    .box-error { rx: 6; stroke-width: 2; fill: #FEE2E2; stroke: #DC2626; }
    .diamond { fill: #E9D5FF; stroke: #9333EA; stroke-width: 2; }
    .label {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 13px;
      fill: #1F2937;
      text-anchor: middle;
      dominant-baseline: middle;
    }
    .label-small {
      font-size: 11px;
      fill: #6B7280;
    }
    .connector { stroke: #4A5568; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
  </style>

  <!-- Step 1: Input -->
  <rect class="box" x="200" y="30" width="300" height="60"/>
  <text class="label" x="350" y="60">Input: requested modules</text>
  <line class="connector" x1="350" y1="90" x2="350" y2="120"/>

  <!-- Step 2: Expand Dependencies -->
  <rect class="box" x="175" y="120" width="350" height="70"/>
  <text class="label" x="350" y="143">1. Expand Dependencies</text>
  <text class="label label-small" x="350" y="165">BFS until no new modules</text>
  <line class="connector" x1="350" y1="190" x2="350" y2="220"/>

  <!-- Step 3: Filter by OS -->
  <rect class="box" x="175" y="220" width="350" height="70"/>
  <text class="label" x="350" y="243">2. Filter by OS Compatibility</text>
  <text class="label label-small" x="350" y="265">Keep if OS matches or empty</text>
  <line class="connector" x1="350" y1="290" x2="350" y2="320"/>

  <!-- Step 4: Build Graph -->
  <rect class="box" x="175" y="320" width="350" height="70"/>
  <text class="label" x="350" y="343">3. Build Dependency Graph</text>
  <text class="label label-small" x="350" y="365">Adjacency list + in-degrees</text>
  <line class="connector" x1="350" y1="390" x2="350" y2="420"/>

  <!-- Step 5: Topological Sort -->
  <rect class="box" x="150" y="420" width="400" height="90"/>
  <text class="label" x="350" y="443">4. Topological Sort</text>
  <text class="label label-small" x="350" y="465">Process zero-degree nodes,</text>
  <text class="label label-small" x="350" y="485">sort by priority within levels</text>
  <line class="connector" x1="350" y1="510" x2="350" y2="560"/>

  <!-- Decision: Remaining nodes? -->
  <polygon class="diamond" points="350,560 450,610 350,660 250,610"/>
  <text class="label" x="350" y="610">Remaining nodes?</text>

  <!-- Yes path - Cycle Error -->
  <line class="connector" x1="250" y1="610" x2="130" y2="610"/>
  <text class="label-small" x="205" y="600">Yes</text>
  <rect class="box-error" x="20" y="580" width="200" height="60"/>
  <text class="label" x="120" y="610">Cycle detected â€” error</text>

  <!-- No path - Success -->
  <line class="connector" x1="450" y1="610" x2="570" y2="610"/>
  <text class="label-small" x="495" y="600">No</text>
  <rect class="box-success" x="470" y="560" width="200" height="100"/>
  <text class="label" x="570" y="590">5. Return ExecutionPlan</text>
  <text class="label label-small" x="570" y="620">Ordered + skipped modules</text>
</svg>
