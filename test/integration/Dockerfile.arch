FROM archlinux:latest
RUN pacman -Syu --noconfirm && pacman -S --noconfirm \
    curl git sudo bash go
# Create test user with sudo
RUN useradd -m -s /bin/bash testuser && \
    echo "testuser ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
# Copy dotfiles repo
COPY . /home/testuser/.dotfiles
RUN chown -R testuser:testuser /home/testuser/.dotfiles
USER testuser
WORKDIR /home/testuser/.dotfiles
ENV DOTFILES_DIR=/home/testuser/.dotfiles
# Build
RUN go build -o bin/dotfiles .
# Copy test script
COPY test/integration/test_install.sh /home/testuser/test_install.sh
CMD ["bash", "/home/testuser/test_install.sh"]
